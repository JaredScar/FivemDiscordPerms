------------------------------------------------
--- Discord Vehicle Whitelist, Made by FAXES ---
------------------------------------------------

--- Config ---
--[[
1, -- Civ
1, -- Trusted Civ
1, -- FAA Heli
1, -- FAA Comm
1, -- Donator Vehicles
1, -- Player
1, -- Staff
1, -- Personal [Shared]
1, -- Personal
1, -- Admin
1, -- Owner
1, -- Donator Vehs 2
1, -- Nitro Boosters
1, -- Elite Supporters
]]--
restrictedVehicles = {
{}, -- This relates to the first item in the roleList (Civ)
{
"16challenger",
"124spider",
"bentaygast",
"explorer",
"gclas9",
"jeep2012",
"p911r",
"s10",
"sprinter",
"x6m",
"alpha",
"banshee",
"bestiagts",
"blista2",
"blista3",
"buffalo",
"buffalo2",
"buffalo3",
"carbonizzare",
"comet2",
"comet3",
"comet4",
"comet5",
"coquette",
"elegy",
"elegy2",
"feltzer2",
"flashgt",
"furoregt",
"fusilade",
"futo",
"gb200",
"hotring",
"italigto",
"jester",
"jester2",
"khamelion",
"kuruma",
"kuruma2",
"lynx",
"massacro",
"massacro2",
"neon",
"ninef",
"ninef2",
"omnis",
"pariah",
"penumbra",
"raiden",
"rapidgt",
"rapidgt2",
"raptor",
"revolter",
"ruston",
"schafter2",
"schafter3",
"schafter4",
"schafter5",
"schlagen",
"schwarzer",
"sentinel3",
"seven70",
"specter",
"specter2",
"sultan",
"surano",
"tampa2",
"tropos",
"verlierer2",
"zr380",
"zr3802",
"zr3803",
"phantom",
"phantom3",
"adder",
"autarch!",
"banshee2",
"bullet",
"cheetah",
"cyclone",
"deveste",
"entityxf",
"entity2",
"fmj",
"gp1",
"infernus",
"italigb",
"italigtb2",
"le6b",
"nero",
"nero2",
"osiris",
"penetrator",
"pfister811",
"prototipo",
"reaper",
"sc1",
"scramjet",
"sheava",
"sultanrs",
"t20",
"taipan",
"tempesta",
"tezeract",
"turismor",
"tyrant",
"tyrus",
"vacca",
"vagner",
"vigilante",
"visione",
"voltic",
"voltic2",
"xa21",
"zentorno",
"sboata",
"sboatb",
}, -- Second item (Trusted Civ)
{
"buzzard2",
"cargobob",
"cargobob2",
"cargobob3",
"cargobob4",
"frogger",
"frogger2",
"havok",
"maverick",
"annihilator",
"polmav",
"seasparrow",
"skylift",
"supervolito",
"supervolito2",
"swift",
"swift2",
"volatus",
}, -- FAA Heli
{
"alphaz1",
"avenger",
"besra",
"cuban800",
"dodo",
"duster",
"howard",
"luxor",
"luxor2",
"mammatus",
"microlight",
"miljet",
"molotok",
"nimbus",
"seabreeze",
"shamal",
"mallard",
"titan",
"velum",
"velum2",
"vestra",
"739",
"748",
"788",
"773er",
"a310",
"a319",
"a320",
"a321neo",
"a333",
"a330neo",
"a340",
"a350",
"a380",
"atr",
"b737800",
"beluga",
"e1000",
"e145",
"e145er",
"e190",
"dc10f",
"l1011",
"208",
"cessna",
}, -- FAA Comm
{
"18performante",
"180sx",
"750li",
"a80",
"aa14",
"aperta",
"bc",
"benzsl63",
"bs17",
"c63w205",
"ccxr",
"centuria",
"corvetteZR1",
"domo",
"gtr",
"fmss",
"huayrar",
"lsv15",
"m6f13",
"mm720",
"mv720",
"raptor150",
"rs7",
"sc18",
"gfboat",
"yacht3a",
"yacht3b",

}, -- Donator Vehicles
{
"ap2",
"camry55",
"cooperworks",
"kia",
"punto",
"r1",
"volvoc30",	
"nitroboat",
"nbtrailer",
}, -- Player
{
"2015polstang",
"hpp50",
"staffCar",
}, -- Staff
{}, -- Personal [Shared]
{}, -- Personal [NOT SHARED]
{
"revolter",
"savestra",
"vigilante",
"scramjet",
"blazer5",
"technical",
"pounder2",
"trailerlarge",
"oppressor2",
"menacer",
"monster",
"brutus",
"comet4",
"monster3",
"monster4",
"monster5",
"meneacer",
"marshall",
"insurgent3",
"insurgent2",
"insurgent",
"dune5",
"dune4",
"dune3",
"dune2",
"caracara",
"brutus3",
"brutus2",
"brutus1",
"bruiser3",
"bruiser2",
"bruiser",
"bralzer5",
"technical3",
"technical2",
"technical1",
"rcbandito",
"nightshark",
"bulldozer",
"molotok",
"seasparrow",
"hauler2",
"mule4",
"speedo4",
"hauler2",
"cutter",
"dump",
"handler",
"forklift",
"tractor",
"boxville2",
"boxville5",
"brickade",
"pbus2",
"rallytruck",
"wasterlander",
"phantom2",
"cerberus",
"cerberus2",
"cerberus3",
"issi3",
"issi4",
"issi5",
"issi6",
"cog552",
"limo2",
"clique",
"deviant",
"dominator4",
"dominator5",
"dominator6",
"prototipo",
"autarch",
"Le7b",
"deveste",
"sheava",
"tezeract",
"vagner",
"dukes2",
"impaler",
"impaler2",
"impaler3",
"impaler4",
"imperator",
"imperator2",
"imperator3",
"ruiner",
"toros",
"ruiner2",
"ruiner3",
"sabregt2",
"slamvan4",
"slamvan5",
"slamvan6",
"tampa3",
"tulip",
"vamos",
"ardent",
"deluxo",
"stromberg",
"italigto",
"kuruma2",
"revolter",
"schlagen",
"zr380",
"zr3802",
"zr3803",
"deathbike",
"deathbike2",
"deathbike3",
"oppressor",
"oprressor2",
"shotaro",
"avenger2",
"blimp",
"blimp2",
"blimp3",
"bombushka",
"cargoplane",
"jet",
"viseris",
"comet4",
"mogul",
"nokota",
"pyro",
"rogue",
"tula",
"volatol",
"akula",
"buzzard",
"hunter",
"savage",
"valkyrie",
"submersible",
"submersible2",
"tug",
"policeold1",
"policeold2",
"vigilante",
"voltic2",
"scramjet",
"rhino",
"barrage",
"trophytruck",
"trophytruck2",
}, -- Admin
{}, -- Owner
{
"amggt63s",
"brabus700",
"bugatti",
"silverado1",
"vip8",
"f8t",
"ghibli",
"gsf",
"mc63",
"nissantitan17",
"s6brabus",
"mr2sw20",
"tr22",
"rmodveneno",
"rboat",
"sr510",
}, -- Donor vehs 2
{
"amggtr",
"c7",
"fgt",
"zl2017",
"teslapd",
"raptor2017",
"dl2016",
"ram16",
"mig",
"evoque",
"urus2018",
"amggtsmansory",
"69charger",
"16charger",
"16m5",
"por4s",
"slingshot",
"huayrar", 
"599GTOX",
"amcj", 
"sc18",
"aaq4", 
"gtcl",
}, -- Nitro Boosters
{
"sr650fly",
"yacht2",
}, -- Elite Supporters
}
--- Code ---

AddEventHandler('playerSpawned', function()
    local src = source
    TriggerServerEvent("FaxDisVeh:CheckPermission", src)
end)

allowedList = {}

RegisterNetEvent("FaxDisVeh:CheckPermission:Return")
AddEventHandler("FaxDisVeh:CheckPermission:Return", function(allowedVehicles, error)
    if error then
        print("[FAX DISCORD VEHICLE WHITELIST ERROR] No Discord identifier was found! Permissions set to false")
    end
	allowedList = allowedVehicles
end)

local function has_value (tab, val)
    for index, value in ipairs(tab) do
        if value == val then
            return true
        end
    end
    return false
end

Citizen.CreateThread(function()
    while true do
        Citizen.Wait(400)

		local ped = PlayerPedId()
		local veh = nil

		if IsPedInAnyVehicle(ped, false) then
			veh = GetVehiclePedIsUsing(ped)
		else
			veh = GetVehiclePedIsTryingToEnter(ped)
		end
		
		if veh and DoesEntityExist(veh) then
			local model = GetEntityModel(veh)
			local driver = GetPedInVehicleSeat(veh, -1)
			-- Check if it has one of the restricted vehicles
			local endLoop = false
			local requiredPerm = nil
			for i = 1, #restrictedVehicles do
				for j = 1, #restrictedVehicles[i] do
					if GetHashKey(restrictedVehicles[i][j]) == model then
						-- It requires a permission
						requiredPerm = i
						endLoop = true
						--TriggerEvent('chat:addMessage', {color = { 255, 0, 0}, multiline = true, args = {"Me", "Requires perm = " .. tostring(i)}}) -- TODO debug - get rid of
						break
					end
				end
				if endLoop then
					break
				end
			end
			local hasPerm = false
			if requiredPerm ~= nil then
				--TriggerEvent('chat:addMessage', {color = { 255, 0, 0}, multiline = true, args = {"Me", "RequiredPerm != nil"}}) -- TODO debug - get rid of
				if has_value(allowedList, requiredPerm) then
					--TriggerEvent('chat:addMessage', {color = { 255, 0, 0}, multiline = true, args = {"Me", "hasPerm = true"}}) -- TODO debug - get rid of
					hasPerm = true
				end
			end
			--TriggerEvent('chat:addMessage', {color = { 255, 0, 0}, multiline = true, args = {"Me", "Value of hasPerm = " .. tostring(hasPerm)}}) -- TODO debug - get rid of
			-- If doesn't have permission, it's a restricted vehicle to them
			if not hasPerm and (requiredPerm ~= nil) then
				if driver == ped then
					ShowInfo("~r~Restricted Vehicle Model.")
					DeleteEntity(veh)
					ClearPedTasksImmediately(ped)
				end
			end
        end
        -- local src = source
        -- TriggerServerEvent("FaxDisVeh:CheckPermission", src)
    end
end)

--- Functions ---
function ShowInfo(text)
	SetNotificationTextEntry("STRING")
	AddTextComponentSubstringPlayerName(text)
	DrawNotification(false, false)
end
function DeleteE(entity)
	Citizen.InvokeNative(0xAE3CBE5BF394C9C9, Citizen.PointerValueIntInitialized(entity))
end
